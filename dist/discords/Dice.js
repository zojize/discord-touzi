"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var t=require("@typeit/discord");function r(t){return t&&"object"==typeof t&&"default"in t?t:{default:t}}var e=r(require("lodash/identity"));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function n(t,r,e,n){var o,c=arguments.length,a=c<3?r:null===n?n=Object.getOwnPropertyDescriptor(r,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(t,r,e,n);else for(var u=t.length-1;u>=0;u--)(o=t[u])&&(a=(c<3?o(a):c>3?o(r,e,a):o(r,e))||a);return c>3&&a&&Object.defineProperty(r,e,a),a}function o(t,r){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(t,r)}const c={"+":1,"-":-1};function a(t,r){switch(t.type){case"dice":return{...t,multiplier:r*(t.multiplier??1)};case"repeat":return{...t,dice:a(t.dice,r)};case"group":return{...t,dice:t.dice.map((t=>a(t,r)))}}}function u(t,r){switch(t.type){case"dice":return{...t,offset:r+(t.offset??0)};case"repeat":return{...t,dice:u(t.dice,r)};case"group":return{...t,dice:t.dice.map((t=>u(t,r)))}}}function i(t,r){switch(t.type){case"dice":return{...t,times:r*(t.times??1)};case"repeat":return{...t,dice:i(t.dice,r)};case"group":return{...t,dice:t.dice.map((t=>i(t,r)))}}}function s(t){return{type:"dice",sides:t}}function l(t,r,e,n){var o=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(o,l.prototype),o.expected=r,o.found=e,o.location=n,o.name="SyntaxError",o}function f(t,r,e){return e=e||" ",t.length>r?t:(r-=t.length,t+(e+=e.repeat(r)).slice(0,r))}function p(t,r){var e,n,o,f,p={},d=(r=void 0!==r?r:{}).grammarSource,h={dice_expr:pt},g=pt,m=/^[dD]/,v=/^[Xx*]/,A=/^[+\-]/,y=/^[#]/,x=/^[0-9]/,C=/^[ \t\n\r]/,b=it("dice group"),w=it("dice repeat"),E=it("dice n times"),O=it("dice offset"),F=it("dice multiplier"),R=it("dice"),S=ut(["d","D"],!1,!1),j=at("%",!1),D=at("(",!1),$=at(")",!1),M=it("list of numbers"),P=at("[",!1),I=at("]",!1),k=it("times opearator"),T=ut(["X","x","*"],!1,!1),N=it("sign"),_=ut(["+","-"],!1,!1),B=it("repeat"),U=ut(["#"],!1,!1),z=it("group seperator"),J=at(",",!1),X=at("&",!1),Z=it("integers"),q=ut([["0","9"]],!1,!1),G=it("unsigned integers"),L=it("whitespace"),W=ut([" ","\t","\n","\r"],!1,!1),H=function(t,r){return function(t,r){return r.length?{type:"group",dice:[t].concat(r)}:t}(t,r)},K=function(t,r){return i(r,t)},Q=function(t,r,e){return u(t,c[r]*e)},V=function(t,r){return a(t,r)},Y=function(){return+t.substring(rt,tt)},tt=0,rt=0,et=[{line:1,column:1}],nt=0,ot=[],ct=0;if("startRule"in r){if(!(r.startRule in h))throw new Error("Can't start parsing from rule \""+r.startRule+'".');g=h[r.startRule]}function at(t,r){return{type:"literal",text:t,ignoreCase:r}}function ut(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function it(t){return{type:"other",description:t}}function st(r){var e,n=et[r];if(n)return n;for(e=r-1;!et[e];)e--;for(n={line:(n=et[e]).line,column:n.column};e<r;)10===t.charCodeAt(e)?(n.line++,n.column=1):n.column++,e++;return et[r]=n,n}function lt(t,r){var e=st(t),n=st(r);return{source:d,start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:n.line,column:n.column}}}function ft(t){tt<nt||(tt>nt&&(nt=tt,ot=[]),ot.push(t))}function pt(){var t,r;return t=tt,wt(),(r=dt())!==p?(wt(),t=r):(tt=t,t=p),t}function dt(){var t,r,e,n,o;if(ct++,t=tt,(r=ht())!==p){for(e=[],n=tt,yt()!==p&&(o=ht())!==p?n=o:(tt=n,n=p);n!==p;)e.push(n),n=tt,yt()!==p&&(o=ht())!==p?n=o:(tt=n,n=p);rt=t,t=H(r,e)}else tt=t,t=p;if(t===p)if(t=tt,(r=ht())!==p){for(e=[],n=tt,xt()!==p&&(o=ht())!==p?n=o:(tt=n,n=p);n!==p;)e.push(n),n=tt,xt()!==p&&(o=ht())!==p?n=o:(tt=n,n=p);rt=t,t=H(r,e)}else tt=t,t=p;return ct--,t===p&&(r=p,0===ct&&ft(b)),t}function ht(){var r,e,n;return ct++,r=tt,(e=bt())!==p&&function(){var r,e;ct++,r=tt,wt(),y.test(t.charAt(tt))?(e=t.charAt(tt),tt++):(e=p,0===ct&&ft(U));e!==p?(wt(),r=e):(tt=r,r=p);ct--,r===p&&0===ct&&ft(B);return r}()!==p&&(n=gt())!==p?(rt=r,r=function(t,r){return function(t,r){return{type:"repeat",times:r,dice:t}}(r,t)}(e,n)):(tt=r,r=p),r===p&&(r=gt()),ct--,r===p&&(e=p,0===ct&&ft(w)),r}function gt(){var t,r,e;return ct++,t=tt,(r=bt())!==p?(wt(),(e=mt())!==p?(rt=t,t=K(r,e)):(tt=t,t=p)):(tt=t,t=p),t===p&&(t=mt()),ct--,t===p&&(r=p,0===ct&&ft(E)),t}function mt(){var r,e,n,o;return ct++,r=tt,(e=vt())!==p&&(n=function(){var r,e;ct++,r=tt,wt(),A.test(t.charAt(tt))?(e=t.charAt(tt),tt++):(e=p,0===ct&&ft(_));e!==p?(wt(),r=e):(tt=r,r=p);ct--,r===p&&0===ct&&ft(N);return r}())!==p&&(o=bt())!==p?(rt=r,r=Q(e,n,o)):(tt=r,r=p),r===p&&(r=vt()),ct--,r===p&&(e=p,0===ct&&ft(O)),r}function vt(){var r,e,n;return ct++,r=tt,(e=At())!==p&&function(){var r,e;ct++,r=tt,wt(),v.test(t.charAt(tt))?(e=t.charAt(tt),tt++):(e=p,0===ct&&ft(T));e!==p?(wt(),r=e):(tt=r,r=p);ct--,r===p&&0===ct&&ft(k);return r}()!==p&&(n=bt())!==p?(rt=r,r=V(e,n)):(tt=r,r=p),r===p&&(r=At()),ct--,r===p&&(e=p,0===ct&&ft(F)),r}function At(){var r,e,n,o;return ct++,r=tt,m.test(t.charAt(tt))?(e=t.charAt(tt),tt++):(e=p,0===ct&&ft(S)),e!==p&&(n=bt())!==p?(rt=r,r=s(n)):(tt=r,r=p),r===p&&(r=tt,m.test(t.charAt(tt))?(e=t.charAt(tt),tt++):(e=p,0===ct&&ft(S)),e!==p?(37===t.charCodeAt(tt)?(n="%",tt++):(n=p,0===ct&&ft(j)),n!==p?(rt=r,r=s(100)):(tt=r,r=p)):(tt=r,r=p),r===p&&(r=tt,m.test(t.charAt(tt))?(e=t.charAt(tt),tt++):(e=p,0===ct&&ft(S)),e!==p&&(n=function(){var r,e,n,o,c,a,u;ct++,r=tt,91===t.charCodeAt(tt)?(e="[",tt++):(e=p,0===ct&&ft(P));if(e!==p)if(wt(),(n=Ct())!==p){for(o=[],c=tt,(a=yt())!==p&&(u=Ct())!==p?c=u:(tt=c,c=p);c!==p;)o.push(c),c=tt,(a=yt())!==p&&(u=Ct())!==p?c=u:(tt=c,c=p);c=wt(),93===t.charCodeAt(tt)?(a="]",tt++):(a=p,0===ct&&ft(I)),a!==p?(rt=r,r=[n].concat(o)):(tt=r,r=p)}else tt=r,r=p;else tt=r,r=p;ct--,r===p&&(e=p,0===ct&&ft(M));return r}())!==p?(rt=r,r=s(n)):(tt=r,r=p),r===p&&(r=tt,40===t.charCodeAt(tt)?(e="(",tt++):(e=p,0===ct&&ft(D)),e!==p&&(n=dt())!==p?(41===t.charCodeAt(tt)?(o=")",tt++):(o=p,0===ct&&ft($)),o!==p?r=n:(tt=r,r=p)):(tt=r,r=p)))),ct--,r===p&&(e=p,0===ct&&ft(R)),r}function yt(){var r,e;return ct++,r=tt,wt(),44===t.charCodeAt(tt)?(e=",",tt++):(e=p,0===ct&&ft(J)),e!==p?(wt(),r=e):(tt=r,r=p),ct--,r===p&&0===ct&&ft(z),r}function xt(){var r,e;return ct++,r=tt,wt(),38===t.charCodeAt(tt)?(e="&",tt++):(e=p,0===ct&&ft(X)),e!==p?(wt(),r=e):(tt=r,r=p),ct--,r===p&&0===ct&&ft(z),r}function Ct(){var r,e,n;if(ct++,r=tt,A.test(t.charAt(tt))?(t.charAt(tt),tt++):0===ct&&ft(_),e=[],x.test(t.charAt(tt))?(n=t.charAt(tt),tt++):(n=p,0===ct&&ft(q)),n!==p)for(;n!==p;)e.push(n),x.test(t.charAt(tt))?(n=t.charAt(tt),tt++):(n=p,0===ct&&ft(q));else e=p;return e!==p?(rt=r,r=Y()):(tt=r,r=p),ct--,r===p&&0===ct&&ft(Z),r}function bt(){var r,e,n;if(ct++,r=tt,e=[],x.test(t.charAt(tt))?(n=t.charAt(tt),tt++):(n=p,0===ct&&ft(q)),n!==p)for(;n!==p;)e.push(n),x.test(t.charAt(tt))?(n=t.charAt(tt),tt++):(n=p,0===ct&&ft(q));else e=p;return e!==p&&(rt=r,e=Y()),ct--,(r=e)===p&&(e=p,0===ct&&ft(G)),r}function wt(){var r,e;for(ct++,r=[],C.test(t.charAt(tt))?(e=t.charAt(tt),tt++):(e=p,0===ct&&ft(W));e!==p;)r.push(e),C.test(t.charAt(tt))?(e=t.charAt(tt),tt++):(e=p,0===ct&&ft(W));return ct--,e=p,0===ct&&ft(L),r}if((e=g())!==p&&tt===t.length)return e;throw e!==p&&tt<t.length&&ft({type:"end"}),n=ot,o=nt<t.length?t.charAt(nt):null,f=nt<t.length?lt(nt,nt+1):lt(nt,nt),new l(l.buildMessage(n,o),n,o,f)}function d(t,r,e,n){var o=Error.call(this,t);return Object.setPrototypeOf&&Object.setPrototypeOf(o,d.prototype),o.expected=r,o.found=e,o.location=n,o.name="SyntaxError",o}function h(t,r,e){return e=e||" ",t.length>r?t:(r-=t.length,t+(e+=e.repeat(r)).slice(0,r))}function g(t,r){var e,n,o,c,a={},u=(r=void 0!==r?r:{}).grammarSource,i={expr:vt},s=vt,l="false",f="null",p="true",h=/^[a-zA-Z\-_$#]/,g=/^[ \t\n\r]/,m=/^[1-9]/,v=/^[eE]/,A=/^[^\0-\x1F"\\]/,y=/^[0-9]/,x=/^[0-9a-f]/i,C=dt("identifier"),b=pt([["a","z"],["A","Z"],"-","_","$","#"],!1,!1),w=dt("assignment operator"),E=ft("=",!1),O=dt("whitespace"),F=pt([" ","\t","\n","\r"],!1,!1),R=ft("false",!1),S=ft("null",!1),j=ft("true",!1),D=ft("[",!1),$=ft("{",!1),M=ft("(",!1),P=ft(")",!1),I=ft("]",!1),k=ft("}",!1),T=ft(":",!1),N=ft(",",!1),_=dt("number"),B=ft(".",!1),U=pt([["1","9"]],!1,!1),z=pt(["e","E"],!1,!1),J=ft("-",!1),X=ft("+",!1),Z=ft("0",!1),q=dt("string"),G=ft('"',!1),L=ft("\\",!1),W=ft("/",!1),H=ft("b",!1),K=ft("f",!1),Q=ft("n",!1),V=ft("r",!1),Y=ft("t",!1),tt=ft("u",!1),rt=pt([["\0",""],'"',"\\"],!0,!1),et=pt([["0","9"]],!1,!1),nt=pt([["0","9"],["a","f"]],!1,!0),ot=function(){return parseFloat(t.substring(at,ct))},ct=0,at=0,ut=[{line:1,column:1}],it=0,st=[],lt=0;if("startRule"in r){if(!(r.startRule in i))throw new Error("Can't start parsing from rule \""+r.startRule+'".');s=i[r.startRule]}function ft(t,r){return{type:"literal",text:t,ignoreCase:r}}function pt(t,r,e){return{type:"class",parts:t,inverted:r,ignoreCase:e}}function dt(t){return{type:"other",description:t}}function ht(r){var e,n=ut[r];if(n)return n;for(e=r-1;!ut[e];)e--;for(n={line:(n=ut[e]).line,column:n.column};e<r;)10===t.charCodeAt(e)?(n.line++,n.column=1):n.column++,e++;return ut[r]=n,n}function gt(t,r){var e=ht(t),n=ht(r);return{source:u,start:{offset:t,line:e.line,column:e.column},end:{offset:r,line:n.line,column:n.column}}}function mt(t){ct<it||(ct>it&&(it=ct,st=[]),st.push(t))}function vt(){var r,e;return r=ct,function(){var r,e,n;r=ct,e=Ct(),40===t.charCodeAt(ct)?(n="(",ct++):(n=a,0===lt&&mt(M));n!==a?r=e=[e,n,Ct()]:(ct=r,r=a);return r}()!==a&&(e=At())!==a&&function(){var r,e,n;r=ct,e=Ct(),41===t.charCodeAt(ct)?(n=")",ct++):(n=a,0===lt&&mt(P));n!==a?r=e=[e,n,Ct()]:(ct=r,r=a);return r}()!==a?r=e:(ct=r,r=a),r===a&&(r=ct,Ct(),(e=At())!==a?(Ct(),r=e):(ct=r,r=a)),r}function At(){var t,r,e,n,o,c;if(t=ct,(r=yt())!==a){for(e=[],n=ct,wt()!==a&&(o=yt())!==a?n=o:(ct=n,n=a);n!==a;)e.push(n),n=ct,wt()!==a&&(o=yt())!==a?n=o:(ct=n,n=a);at=t,c=r,t=e.reduce(((t,r)=>Object.assign({},t,r)),c)}else ct=t,t=a;return t===a&&(t=ct,r=Ct(),at=t,t=r={}),t}function yt(){var r,e,n;return r=ct,(e=xt())!==a?(Ct(),function(){var r;lt++,61===t.charCodeAt(ct)?(r="=",ct++):(r=a,0===lt&&mt(E));lt--,r===a&&0===lt&&mt(w);return r}()!==a?(Ct(),(n=bt())!==a?(at=r,r={[e]:n}):(ct=r,r=a)):(ct=r,r=a)):(ct=r,r=a),r===a&&(r=ct,(e=xt())!==a&&(at=r,e={[e]:!0}),r=e),r}function xt(){var r,e,n;if(lt++,r=ct,e=[],h.test(t.charAt(ct))?(n=t.charAt(ct),ct++):(n=a,0===lt&&mt(b)),n!==a)for(;n!==a;)e.push(n),h.test(t.charAt(ct))?(n=t.charAt(ct),ct++):(n=a,0===lt&&mt(b));else e=a;return r=e!==a?t.substring(r,ct):e,lt--,r===a&&(e=a,0===lt&&mt(C)),r}function Ct(){var r,e;for(lt++,r=[],g.test(t.charAt(ct))?(e=t.charAt(ct),ct++):(e=a,0===lt&&mt(F));e!==a;)r.push(e),g.test(t.charAt(ct))?(e=t.charAt(ct),ct++):(e=a,0===lt&&mt(F));return lt--,e=a,0===lt&&mt(O),r}function bt(){var r;return(r=function(){var r,e;r=ct,t.substr(ct,5)===l?(e=l,ct+=5):(e=a,0===lt&&mt(R));e!==a&&(at=r,e=!1);return r=e}())===a&&(r=function(){var r,e;r=ct,t.substr(ct,4)===f?(e=f,ct+=4):(e=a,0===lt&&mt(S));e!==a&&(at=r,e=null);return r=e}())===a&&(r=function(){var r,e;r=ct,t.substr(ct,4)===p?(e=p,ct+=4):(e=a,0===lt&&mt(j));e!==a&&(at=r,e=!0);return r=e}())===a&&(r=function(){var r,e,n,o,c,u;if(r=ct,function(){var r,e,n;r=ct,e=Ct(),123===t.charCodeAt(ct)?(n="{",ct++):(n=a,0===lt&&mt($));n!==a?r=e=[e,n,Ct()]:(ct=r,r=a);return r}()!==a){if(e=ct,(n=Et())!==a){for(o=[],c=ct,wt()!==a&&(u=Et())!==a?c=u:(ct=c,c=a);c!==a;)o.push(c),c=ct,wt()!==a&&(u=Et())!==a?c=u:(ct=c,c=a);at=e,i={},[n].concat(o).forEach((function(t){i[t.name]=t.value})),e=i}else ct=e,e=a;e===a&&(e=null),(n=function(){var r,e,n;r=ct,e=Ct(),125===t.charCodeAt(ct)?(n="}",ct++):(n=a,0===lt&&mt(k));n!==a?r=e=[e,n,Ct()]:(ct=r,r=a);return r}())!==a?(at=r,r=e??{}):(ct=r,r=a)}else ct=r,r=a;var i;return r}())===a&&(r=function(){var r,e,n,o,c,u;if(r=ct,function(){var r,e,n;r=ct,e=Ct(),91===t.charCodeAt(ct)?(n="[",ct++):(n=a,0===lt&&mt(D));n!==a?r=e=[e,n,Ct()]:(ct=r,r=a);return r}()!==a){if(e=ct,(n=bt())!==a){for(o=[],c=ct,wt()!==a&&(u=bt())!==a?c=u:(ct=c,c=a);c!==a;)o.push(c),c=ct,wt()!==a&&(u=bt())!==a?c=u:(ct=c,c=a);at=e,e=[n].concat(o)}else ct=e,e=a;e===a&&(e=null),(n=function(){var r,e,n;r=ct,e=Ct(),93===t.charCodeAt(ct)?(n="]",ct++):(n=a,0===lt&&mt(I));n!==a?r=e=[e,n,Ct()]:(ct=r,r=a);return r}())!==a?(at=r,r=e??[]):(ct=r,r=a)}else ct=r,r=a;return r}())===a&&(r=function(){var r;lt++,r=ct,Ot(),function(){var r,e,n,o;if((r=function(){var r;48===t.charCodeAt(ct)?(r="0",ct++):(r=a,0===lt&&mt(Z));return r}())===a)if(r=ct,(e=function(){var r;m.test(t.charAt(ct))?(r=t.charAt(ct),ct++):(r=a,0===lt&&mt(U));return r}())!==a){for(n=[],o=jt();o!==a;)n.push(o),o=jt();r=e=[e,n]}else ct=r,r=a;return r}()!==a?(!function(){var r,e,n,o;if(r=ct,(e=function(){var r;46===t.charCodeAt(ct)?(r=".",ct++):(r=a,0===lt&&mt(B));return r}())!==a){if(n=[],(o=jt())!==a)for(;o!==a;)n.push(o),o=jt();else n=a;n!==a?r=e=[e,n]:(ct=r,r=a)}else ct=r,r=a}(),function(){var r,e,n,o,c;if(r=ct,(e=function(){var r;v.test(t.charAt(ct))?(r=t.charAt(ct),ct++):(r=a,0===lt&&mt(z));return r}())!==a){if((n=Ot())===a&&(n=function(){var r;43===t.charCodeAt(ct)?(r="+",ct++):(r=a,0===lt&&mt(X));return r}()),n===a&&(n=null),o=[],(c=jt())!==a)for(;c!==a;)o.push(c),c=jt();else o=a;o!==a?r=e=[e,n,o]:(ct=r,r=a)}else ct=r,r=a}(),at=r,r=ot()):(ct=r,r=a);lt--,r===a&&0===lt&&mt(_);return r}())===a&&(r=Ft()),r}function wt(){var r,e,n;return r=ct,e=Ct(),44===t.charCodeAt(ct)?(n=",",ct++):(n=a,0===lt&&mt(N)),n!==a?r=e=[e,n,Ct()]:(ct=r,r=a),r}function Et(){var r,e,n;return r=ct,(e=Ft())!==a&&function(){var r,e,n;return r=ct,e=Ct(),58===t.charCodeAt(ct)?(n=":",ct++):(n=a,0===lt&&mt(T)),n!==a?r=e=[e,n,Ct()]:(ct=r,r=a),r}()!==a&&(n=bt())!==a?(at=r,r={name:e,value:n}):(ct=r,r=a),r}function Ot(){var r;return 45===t.charCodeAt(ct)?(r="-",ct++):(r=a,0===lt&&mt(J)),r}function Ft(){var t,r,e;if(lt++,t=ct,St()!==a){for(r=[],e=Rt();e!==a;)r.push(e),e=Rt();(e=St())!==a?(at=t,t=r.join("")):(ct=t,t=a)}else ct=t,t=a;return lt--,t===a&&(a,0===lt&&mt(q)),t}function Rt(){var r,e,n,o,c,u,i,s,l,f;return(r=function(){var r;A.test(t.charAt(ct))?(r=t.charAt(ct),ct++):(r=a,0===lt&&mt(rt));return r}())===a&&(r=ct,function(){var r;92===t.charCodeAt(ct)?(r="\\",ct++):(r=a,0===lt&&mt(L));return r}()!==a?(34===t.charCodeAt(ct)?(e='"',ct++):(e=a,0===lt&&mt(G)),e===a&&(92===t.charCodeAt(ct)?(e="\\",ct++):(e=a,0===lt&&mt(L)),e===a&&(47===t.charCodeAt(ct)?(e="/",ct++):(e=a,0===lt&&mt(W)),e===a&&(e=ct,98===t.charCodeAt(ct)?(n="b",ct++):(n=a,0===lt&&mt(H)),n!==a&&(at=e,n="\b"),(e=n)===a&&(e=ct,102===t.charCodeAt(ct)?(n="f",ct++):(n=a,0===lt&&mt(K)),n!==a&&(at=e,n="\f"),(e=n)===a&&(e=ct,110===t.charCodeAt(ct)?(n="n",ct++):(n=a,0===lt&&mt(Q)),n!==a&&(at=e,n="\n"),(e=n)===a&&(e=ct,114===t.charCodeAt(ct)?(n="r",ct++):(n=a,0===lt&&mt(V)),n!==a&&(at=e,n="\r"),(e=n)===a&&(e=ct,116===t.charCodeAt(ct)?(n="t",ct++):(n=a,0===lt&&mt(Y)),n!==a&&(at=e,n="\t"),(e=n)===a&&(e=ct,117===t.charCodeAt(ct)?(n="u",ct++):(n=a,0===lt&&mt(tt)),n!==a?(o=ct,c=ct,(u=Dt())!==a&&(i=Dt())!==a&&(s=Dt())!==a&&(l=Dt())!==a?c=u=[u,i,s,l]:(ct=c,c=a),(o=c!==a?t.substring(o,ct):c)!==a?(at=e,f=o,e=String.fromCharCode(parseInt(f,16))):(ct=e,e=a)):(ct=e,e=a))))))))),e!==a?(at=r,r=e):(ct=r,r=a)):(ct=r,r=a)),r}function St(){var r;return 34===t.charCodeAt(ct)?(r='"',ct++):(r=a,0===lt&&mt(G)),r}function jt(){var r;return y.test(t.charAt(ct))?(r=t.charAt(ct),ct++):(r=a,0===lt&&mt(et)),r}function Dt(){var r;return x.test(t.charAt(ct))?(r=t.charAt(ct),ct++):(r=a,0===lt&&mt(nt)),r}if((e=s())!==a&&ct===t.length)return e;throw e!==a&&ct<t.length&&mt({type:"end"}),n=st,o=it<t.length?t.charAt(it):null,c=it<t.length?gt(it,it+1):gt(it,it),new d(d.buildMessage(n,o),n,o,c)}!function(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}(l,Error),l.prototype.format=function(t){var r="Error: "+this.message;if(this.location){var e,n=null;for(e=0;e<t.length;e++)if(t[e].source===this.location.source){n=t[e].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,c=this.location.source+":"+o.line+":"+o.column;if(n){var a=this.location.end,u=f("",o.line.toString().length),i=n[o.line-1],s=o.line===a.line?a.column:i.length+1;r+="\n --\x3e "+c+"\n"+u+" |\n"+o.line+" | "+i+"\n"+u+" | "+f("",o.column-1)+f("",s-o.column,"^")}else r+="\n at "+c}return r},l.buildMessage=function(t,r){var e={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var r=t.parts.map((function(t){return Array.isArray(t)?c(t[0])+"-"+c(t[1]):c(t)}));return"["+(t.inverted?"^":"")+r+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function c(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return e[t.type](t)}return"Expected "+function(t){var r,e,n=t.map(a);if(n.sort(),n.length>0){for(r=1,e=1;r<n.length;r++)n[r-1]!==n[r]&&(n[e]=n[r],e++);n.length=e}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(r)+" found."},function(t,r){function e(){this.constructor=t}e.prototype=r.prototype,t.prototype=new e}(d,Error),d.prototype.format=function(t){var r="Error: "+this.message;if(this.location){var e,n=null;for(e=0;e<t.length;e++)if(t[e].source===this.location.source){n=t[e].text.split(/\r\n|\n|\r/g);break}var o=this.location.start,c=this.location.source+":"+o.line+":"+o.column;if(n){var a=this.location.end,u=h("",o.line.toString().length),i=n[o.line-1],s=o.line===a.line?a.column:i.length+1;r+="\n --\x3e "+c+"\n"+u+" |\n"+o.line+" | "+i+"\n"+u+" | "+h("",o.column-1)+h("",s-o.column,"^")}else r+="\n at "+c}return r},d.buildMessage=function(t,r){var e={literal:function(t){return'"'+o(t.text)+'"'},class:function(t){var r=t.parts.map((function(t){return Array.isArray(t)?c(t[0])+"-"+c(t[1]):c(t)}));return"["+(t.inverted?"^":"")+r+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(t){return t.description}};function n(t){return t.charCodeAt(0).toString(16).toUpperCase()}function o(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function c(t){return t.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(t){return"\\x0"+n(t)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(t){return"\\x"+n(t)}))}function a(t){return e[t.type](t)}return"Expected "+function(t){var r,e,n=t.map(a);if(n.sort(),n.length>0){for(r=1,e=1;r<n.length;r++)n[r-1]!==n[r]&&(n[e]=n[r],e++);n.length=e}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(t)+" but "+function(t){return t?'"'+o(t)+'"':"end of input"}(r)+" found."};const m=async([t],r,e)=>{t.content.startsWith("!")&&await e()},v=["roll","r"];function A(t){let r,e,n;switch(t.type){case"dice":{const{sides:a,multiplier:u,offset:i,times:s}=t;r=Array.from(c(s??1)).map(Array.isArray(a)?()=>{return(t=a)[o(0,t.length)]*(u??1)+(i??0);var t}:()=>o(1,a+1)*(u??1)+(i??0)),e=Array.isArray(r)?r.reduce(((t,r)=>t+r)):r,n=(s?`${s}`:"")+`d${JSON.stringify(a)}`+(u?`*${u}`:"")+(i?`${i>=0?"+":"-"}${Math.abs(i)}`:"")+(r.length>1?`(${r.join("+")})`:"")+`=${e}`;break}case"repeat":{const{times:o}=t;r=Array.from(c(o)).map((()=>A(t.dice))),e=r.reduce(((t,r)=>t+r.result),0),n=`{\n${a(r.map((t=>t.formatted)).join(" +\n"))}\n}=${e}`;break}case"group":r=t.dice.map(A),e=r.reduce(((t,r)=>t+r.result),0),n=`[\n${a(r.map((t=>t.formatted)).join(" +\n"))}\n]=${e}`}return{result:e,results:r,formatted:n};function o(t,r){return Math.floor(Math.random()*(r-t)+t)}function*c(t){for(let r=0;r<t;r++)yield r}function a(t,r="  "){return(r+t).replaceAll("\n","\n"+r)}}exports.RollDice=class{onReady(t,r){console.log(`Bot ${r.user?.tag} is ready.`)}onMessage([t]){const r=function(t){const r=t.match(y);if(r){const{command:e,kwargs:n}=r.groups;return{commandName:e,commandBody:t.replace(y,""),kwargs:n?g(n):void 0}}throw Error("not a command")}(t.content);console.log(`received command: ${JSON.stringify(r)}`);const{commandName:n,commandBody:o,kwargs:c}=r;if(v.includes(n)){const{debug:r=!1,help:n=!1,min:a=!1,"no-roll":u=!1}=c??{};let i;if(n)return void t.channel.send("Basic Syntax: \n   `(<REPEAT>#)?<DICE TOSS TIMES>?[dD]<DICE SIDES | DICE OPTIONS | %>(+<OFFSET>)?([Xx*]<MULTIPLIER>)`\n\nExamples: \n   `3d6`: toss a 6 sided dice 3 times\n   `3#3d6`: for 3 times, toss a 6 sided dice 3 times\n   `d[1, 2, 0]`: choose randomly from numbers 1, 2 and 0\n\nAdvanced Uses: \n   Dice Groups: \n       Two or more dice can be grouped with `,` as seperator \n       e.g.: `3#(3d6, 2d3)`, `3D[2, 3], 2D%+50`\n");if(o.length)try{i=p(o)}catch(t){return}if(void 0!==i){const n=(u?e.default:A)(i);return void(n&&t.reply(r?JSON.stringify(n):a?`${n.result}`:n.formatted))}}}},n([t.Once("ready"),o("design:type",Function),o("design:paramtypes",[Object,Function]),o("design:returntype",void 0)],exports.RollDice.prototype,"onReady",null),n([t.On("message"),t.Guard(m),o("design:type",Function),o("design:paramtypes",[Object]),o("design:returntype",void 0)],exports.RollDice.prototype,"onMessage",null),exports.RollDice=n([t.Discord()],exports.RollDice);const y=/!(?<command>[a-zA-Z+\-#$%@]+)(?<kwargs>\(.*?\))?/;exports.isCommand=m;
//# sourceMappingURL=Dice.js.map
