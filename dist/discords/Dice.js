"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@typeit/discord");function t(r){return r&&"object"==typeof r&&"default"in r?r:{default:r}}var e=t(require("lodash/identity"));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */function n(r,t,e,n){var c,o=arguments.length,u=o<3?t:null===n?n=Object.getOwnPropertyDescriptor(t,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)u=Reflect.decorate(r,t,e,n);else for(var a=r.length-1;a>=0;a--)(c=r[a])&&(u=(o<3?c(u):o>3?c(t,e,u):c(t,e))||u);return o>3&&u&&Object.defineProperty(t,e,u),u}function c(r,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(r,t)}const o={"+":1,"-":-1};function u(r,t){switch(r.type){case"dice":return{...r,multiplier:t*(r.multiplier??1)};case"repeat":return{...r,dice:u(r.dice,t)};case"group":return{...r,dice:r.dice.map((r=>u(r,t)))}}}function a(r,t){switch(r.type){case"dice":return{...r,offset:t+(r.offset??0)};case"repeat":return{...r,dice:a(r.dice,t)};case"group":return{...r,dice:r.dice.map((r=>a(r,t)))}}}function i(r,t){switch(r.type){case"dice":return{...r,times:t*(r.times??1)};case"repeat":return{...r,dice:i(r.dice,t)};case"group":return{...r,dice:r.dice.map((r=>i(r,t)))}}}function s(r){return{type:"dice",sides:r}}function f(r,t,e,n){this.message=r,this.expected=t,this.found=e,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,f)}function l(r,t){t=void 0!==t?t:{};var e,n,c,l,p={},d={dice_expr:lr},h=lr,g=ar("dice group"),A=function(r,t){return function(r,t){return t.length?{type:"group",dice:[r].concat(t)}:r}(r,t)},m=ar("dice repeat"),v=ar("dice n times"),y=function(r,t){return i(t,r)},x=ar("dice offset"),C=function(r,t,e){return a(r,o[t]*e)},b=ar("dice multiplier"),w=function(r,t){return u(r,t)},E=ar("dice"),F=/^[dD]/,R=ur(["d","D"],!1,!1),S=or("%",!1),D=or("(",!1),$=or(")",!1),O=ar("list of numbers"),j=or("[",!1),M=or("]",!1),T=ar("times opearator"),k=/^[Xx*]/,I=ur(["X","x","*"],!1,!1),N=ar("sign"),P=/^[+\-]/,_=ur(["+","-"],!1,!1),B=ar("repeat"),U=/^[#]/,z=ur(["#"],!1,!1),J=ar("group seperator"),X=or(",",!1),Z=or("&",!1),q=ar("integers"),G=/^[0-9]/,L=ur([["0","9"]],!1,!1),W=function(){return+r.substring(rr,Y)},H=ar("unsigned integers"),K=ar("whitespace"),Q=/^[ \t\n\r]/,V=ur([" ","\t","\n","\r"],!1,!1),Y=0,rr=0,tr=[{line:1,column:1}],er=0,nr=[],cr=0;if("startRule"in t){if(!(t.startRule in d))throw new Error("Can't start parsing from rule \""+t.startRule+'".');h=d[t.startRule]}function or(r,t){return{type:"literal",text:r,ignoreCase:t}}function ur(r,t,e){return{type:"class",parts:r,inverted:t,ignoreCase:e}}function ar(r){return{type:"other",description:r}}function ir(t){var e,n=tr[t];if(n)return n;for(e=t-1;!tr[e];)e--;for(n={line:(n=tr[e]).line,column:n.column};e<t;)10===r.charCodeAt(e)?(n.line++,n.column=1):n.column++,e++;return tr[t]=n,n}function sr(r,t){var e=ir(r),n=ir(t);return{start:{offset:r,line:e.line,column:e.column},end:{offset:t,line:n.line,column:n.column}}}function fr(r){Y<er||(Y>er&&(er=Y,nr=[]),nr.push(r))}function lr(){var r,t;return r=Y,br()!==p&&(t=pr())!==p&&br()!==p?r=t:(Y=r,r=p),r}function pr(){var r,t,e,n,c;if(cr++,r=Y,(t=dr())!==p){for(e=[],n=Y,vr()!==p&&(c=dr())!==p?n=c:(Y=n,n=p);n!==p;)e.push(n),n=Y,vr()!==p&&(c=dr())!==p?n=c:(Y=n,n=p);e!==p?(rr=r,r=t=A(t,e)):(Y=r,r=p)}else Y=r,r=p;if(r===p)if(r=Y,(t=dr())!==p){for(e=[],n=Y,yr()!==p&&(c=dr())!==p?n=c:(Y=n,n=p);n!==p;)e.push(n),n=Y,yr()!==p&&(c=dr())!==p?n=c:(Y=n,n=p);e!==p?(rr=r,r=t=A(t,e)):(Y=r,r=p)}else Y=r,r=p;return cr--,r===p&&(t=p,0===cr&&fr(g)),r}function dr(){var t,e,n;return cr++,t=Y,(e=Cr())!==p&&function(){var t,e;cr++,t=Y,br()!==p?(U.test(r.charAt(Y))?(e=r.charAt(Y),Y++):(e=p,0===cr&&fr(z)),e!==p&&br()!==p?t=e:(Y=t,t=p)):(Y=t,t=p);cr--,t===p&&(p,0===cr&&fr(B));return t}()!==p&&(n=hr())!==p?(rr=t,t=e=function(r,t){return function(r,t){return{type:"repeat",times:t,dice:r}}(t,r)}(e,n)):(Y=t,t=p),t===p&&(t=hr()),cr--,t===p&&(e=p,0===cr&&fr(m)),t}function hr(){var r,t,e;return cr++,r=Y,(t=Cr())!==p&&br()!==p&&(e=gr())!==p?(rr=r,r=t=y(t,e)):(Y=r,r=p),r===p&&(r=gr()),cr--,r===p&&(t=p,0===cr&&fr(v)),r}function gr(){var t,e,n,c;return cr++,t=Y,(e=Ar())!==p&&(n=function(){var t,e;cr++,t=Y,br()!==p?(P.test(r.charAt(Y))?(e=r.charAt(Y),Y++):(e=p,0===cr&&fr(_)),e!==p&&br()!==p?t=e:(Y=t,t=p)):(Y=t,t=p);cr--,t===p&&(p,0===cr&&fr(N));return t}())!==p&&(c=Cr())!==p?(rr=t,t=e=C(e,n,c)):(Y=t,t=p),t===p&&(t=Ar()),cr--,t===p&&(e=p,0===cr&&fr(x)),t}function Ar(){var t,e,n;return cr++,t=Y,(e=mr())!==p&&function(){var t,e;cr++,t=Y,br()!==p?(k.test(r.charAt(Y))?(e=r.charAt(Y),Y++):(e=p,0===cr&&fr(I)),e!==p&&br()!==p?t=e:(Y=t,t=p)):(Y=t,t=p);cr--,t===p&&(p,0===cr&&fr(T));return t}()!==p&&(n=Cr())!==p?(rr=t,t=e=w(e,n)):(Y=t,t=p),t===p&&(t=mr()),cr--,t===p&&(e=p,0===cr&&fr(b)),t}function mr(){var t,e,n,c;return cr++,t=Y,F.test(r.charAt(Y))?(e=r.charAt(Y),Y++):(e=p,0===cr&&fr(R)),e!==p&&(n=Cr())!==p?(rr=t,t=e=s(n)):(Y=t,t=p),t===p&&(t=Y,F.test(r.charAt(Y))?(e=r.charAt(Y),Y++):(e=p,0===cr&&fr(R)),e!==p?(37===r.charCodeAt(Y)?(n="%",Y++):(n=p,0===cr&&fr(S)),n!==p?(rr=t,t=e=s(100)):(Y=t,t=p)):(Y=t,t=p),t===p&&(t=Y,F.test(r.charAt(Y))?(e=r.charAt(Y),Y++):(e=p,0===cr&&fr(R)),e!==p&&(n=function(){var t,e,n,c,o,u,a;cr++,t=Y,91===r.charCodeAt(Y)?(e="[",Y++):(e=p,0===cr&&fr(j));if(e!==p)if(br()!==p)if((n=xr())!==p){for(c=[],o=Y,(u=vr())!==p&&(a=xr())!==p?o=a:(Y=o,o=p);o!==p;)c.push(o),o=Y,(u=vr())!==p&&(a=xr())!==p?o=a:(Y=o,o=p);c!==p&&(o=br())!==p?(93===r.charCodeAt(Y)?(u="]",Y++):(u=p,0===cr&&fr(M)),u!==p?(rr=t,t=e=[n].concat(c)):(Y=t,t=p)):(Y=t,t=p)}else Y=t,t=p;else Y=t,t=p;else Y=t,t=p;cr--,t===p&&(e=p,0===cr&&fr(O));return t}())!==p?(rr=t,t=e=s(n)):(Y=t,t=p),t===p&&(t=Y,40===r.charCodeAt(Y)?(e="(",Y++):(e=p,0===cr&&fr(D)),e!==p&&(n=pr())!==p?(41===r.charCodeAt(Y)?(c=")",Y++):(c=p,0===cr&&fr($)),c!==p?t=n:(Y=t,t=p)):(Y=t,t=p)))),cr--,t===p&&(e=p,0===cr&&fr(E)),t}function vr(){var t,e;return cr++,t=Y,br()!==p?(44===r.charCodeAt(Y)?(e=",",Y++):(e=p,0===cr&&fr(X)),e!==p&&br()!==p?t=e:(Y=t,t=p)):(Y=t,t=p),cr--,t===p&&(p,0===cr&&fr(J)),t}function yr(){var t,e;return cr++,t=Y,br()!==p?(38===r.charCodeAt(Y)?(e="&",Y++):(e=p,0===cr&&fr(Z)),e!==p&&br()!==p?t=e:(Y=t,t=p)):(Y=t,t=p),cr--,t===p&&(p,0===cr&&fr(J)),t}function xr(){var t,e,n,c;if(cr++,t=Y,P.test(r.charAt(Y))?(e=r.charAt(Y),Y++):(e=p,0===cr&&fr(_)),e===p&&(e=null),e!==p){if(n=[],G.test(r.charAt(Y))?(c=r.charAt(Y),Y++):(c=p,0===cr&&fr(L)),c!==p)for(;c!==p;)n.push(c),G.test(r.charAt(Y))?(c=r.charAt(Y),Y++):(c=p,0===cr&&fr(L));else n=p;n!==p?(rr=t,t=e=W()):(Y=t,t=p)}else Y=t,t=p;return cr--,t===p&&(e=p,0===cr&&fr(q)),t}function Cr(){var t,e,n;if(cr++,t=Y,e=[],G.test(r.charAt(Y))?(n=r.charAt(Y),Y++):(n=p,0===cr&&fr(L)),n!==p)for(;n!==p;)e.push(n),G.test(r.charAt(Y))?(n=r.charAt(Y),Y++):(n=p,0===cr&&fr(L));else e=p;return e!==p&&(rr=t,e=W()),cr--,(t=e)===p&&(e=p,0===cr&&fr(H)),t}function br(){var t,e;for(cr++,t=[],Q.test(r.charAt(Y))?(e=r.charAt(Y),Y++):(e=p,0===cr&&fr(V));e!==p;)t.push(e),Q.test(r.charAt(Y))?(e=r.charAt(Y),Y++):(e=p,0===cr&&fr(V));return cr--,t===p&&(e=p,0===cr&&fr(K)),t}if((e=h())!==p&&Y===r.length)return e;throw e!==p&&Y<r.length&&fr({type:"end"}),n=nr,c=er<r.length?r.charAt(er):null,l=er<r.length?sr(er,er+1):sr(er,er),new f(f.buildMessage(n,c),n,c,l)}function p(r,t,e,n){this.message=r,this.expected=t,this.found=e,this.location=n,this.name="SyntaxError","function"==typeof Error.captureStackTrace&&Error.captureStackTrace(this,p)}function d(r,t){t=void 0!==t?t:{};var e,n,c,o,u={},a={expr:Ar},i=Ar,s=pr("identifier"),f=/^[a-zA-Z\-_$#]/,l=lr([["a","z"],["A","Z"],"-","_","$","#"],!1,!1),d=pr("assignment operator"),h=fr("=",!1),g=pr("whitespace"),A=/^[ \t\n\r]/,m=lr([" ","\t","\n","\r"],!1,!1),v="false",y=fr("false",!1),x="null",C=fr("null",!1),b="true",w=fr("true",!1),E=fr("[",!1),F=fr("{",!1),R=fr("(",!1),S=fr(")",!1),D=fr("]",!1),$=fr("}",!1),O=fr(":",!1),j=fr(",",!1),M=pr("number"),T=function(){return parseFloat(r.substring(or,cr))},k=fr(".",!1),I=/^[1-9]/,N=lr([["1","9"]],!1,!1),P=/^[eE]/,_=lr(["e","E"],!1,!1),B=fr("-",!1),U=fr("+",!1),z=fr("0",!1),J=pr("string"),X=fr('"',!1),Z=fr("\\",!1),q=fr("/",!1),G=fr("b",!1),L=fr("f",!1),W=fr("n",!1),H=fr("r",!1),K=fr("t",!1),Q=fr("u",!1),V=/^[^\0-\x1F"\\]/,Y=lr([["\0",""],'"',"\\"],!0,!1),rr=/^[0-9]/,tr=lr([["0","9"]],!1,!1),er=/^[0-9a-f]/i,nr=lr([["0","9"],["a","f"]],!1,!0),cr=0,or=0,ur=[{line:1,column:1}],ar=0,ir=[],sr=0;if("startRule"in t){if(!(t.startRule in a))throw new Error("Can't start parsing from rule \""+t.startRule+'".');i=a[t.startRule]}function fr(r,t){return{type:"literal",text:r,ignoreCase:t}}function lr(r,t,e){return{type:"class",parts:r,inverted:t,ignoreCase:e}}function pr(r){return{type:"other",description:r}}function dr(t){var e,n=ur[t];if(n)return n;for(e=t-1;!ur[e];)e--;for(n={line:(n=ur[e]).line,column:n.column};e<t;)10===r.charCodeAt(e)?(n.line++,n.column=1):n.column++,e++;return ur[t]=n,n}function hr(r,t){var e=dr(r),n=dr(t);return{start:{offset:r,line:e.line,column:e.column},end:{offset:t,line:n.line,column:n.column}}}function gr(r){cr<ar||(cr>ar&&(ar=cr,ir=[]),ir.push(r))}function Ar(){var t,e;return t=cr,function(){var t,e,n,c;t=cr,(e=xr())!==u?(40===r.charCodeAt(cr)?(n="(",cr++):(n=u,0===sr&&gr(R)),n!==u&&(c=xr())!==u?t=e=[e,n,c]:(cr=t,t=u)):(cr=t,t=u);return t}()!==u&&(e=mr())!==u&&function(){var t,e,n,c;t=cr,(e=xr())!==u?(41===r.charCodeAt(cr)?(n=")",cr++):(n=u,0===sr&&gr(S)),n!==u&&(c=xr())!==u?t=e=[e,n,c]:(cr=t,t=u)):(cr=t,t=u);return t}()!==u?t=e:(cr=t,t=u),t===u&&(t=cr,xr()!==u&&(e=mr())!==u&&xr()!==u?t=e:(cr=t,t=u)),t}function mr(){var r,t,e,n,c,o;if(r=cr,(t=vr())!==u){for(e=[],n=cr,br()!==u&&(c=vr())!==u?n=c:(cr=n,n=u);n!==u;)e.push(n),n=cr,br()!==u&&(c=vr())!==u?n=c:(cr=n,n=u);e!==u?(or=r,o=t,r=t=e.reduce(((r,t)=>Object.assign({},r,t)),o)):(cr=r,r=u)}else cr=r,r=u;return r===u&&(r=cr,(t=xr())!==u&&(or=r,t={}),r=t),r}function vr(){var t,e,n;return t=cr,(e=yr())!==u&&xr()!==u&&function(){var t;sr++,61===r.charCodeAt(cr)?(t="=",cr++):(t=u,0===sr&&gr(h));sr--,t===u&&0===sr&&gr(d);return t}()!==u&&xr()!==u&&(n=Cr())!==u?(or=t,t=e={[e]:n}):(cr=t,t=u),t===u&&(t=cr,(e=yr())!==u&&(or=t,e={[e]:!0}),t=e),t}function yr(){var t,e,n;if(sr++,t=cr,e=[],f.test(r.charAt(cr))?(n=r.charAt(cr),cr++):(n=u,0===sr&&gr(l)),n!==u)for(;n!==u;)e.push(n),f.test(r.charAt(cr))?(n=r.charAt(cr),cr++):(n=u,0===sr&&gr(l));else e=u;return t=e!==u?r.substring(t,cr):e,sr--,t===u&&(e=u,0===sr&&gr(s)),t}function xr(){var t,e;for(sr++,t=[],A.test(r.charAt(cr))?(e=r.charAt(cr),cr++):(e=u,0===sr&&gr(m));e!==u;)t.push(e),A.test(r.charAt(cr))?(e=r.charAt(cr),cr++):(e=u,0===sr&&gr(m));return sr--,t===u&&(e=u,0===sr&&gr(g)),t}function Cr(){var t;return(t=function(){var t,e;t=cr,r.substr(cr,5)===v?(e=v,cr+=5):(e=u,0===sr&&gr(y));e!==u&&(or=t,e=!1);return t=e}())===u&&(t=function(){var t,e;t=cr,r.substr(cr,4)===x?(e=x,cr+=4):(e=u,0===sr&&gr(C));e!==u&&(or=t,e=null);return t=e}())===u&&(t=function(){var t,e;t=cr,r.substr(cr,4)===b?(e=b,cr+=4):(e=u,0===sr&&gr(w));e!==u&&(or=t,e=!0);return t=e}())===u&&(t=function(){var t,e,n,c,o,a;if(t=cr,function(){var t,e,n,c;t=cr,(e=xr())!==u?(123===r.charCodeAt(cr)?(n="{",cr++):(n=u,0===sr&&gr(F)),n!==u&&(c=xr())!==u?t=e=[e,n,c]:(cr=t,t=u)):(cr=t,t=u);return t}()!==u){if(e=cr,(n=wr())!==u){for(c=[],o=cr,br()!==u&&(a=wr())!==u?o=a:(cr=o,o=u);o!==u;)c.push(o),o=cr,br()!==u&&(a=wr())!==u?o=a:(cr=o,o=u);c!==u?(or=e,i={},[n].concat(c).forEach((function(r){i[r.name]=r.value})),e=n=i):(cr=e,e=u)}else cr=e,e=u;e===u&&(e=null),e!==u&&(n=function(){var t,e,n,c;t=cr,(e=xr())!==u?(125===r.charCodeAt(cr)?(n="}",cr++):(n=u,0===sr&&gr($)),n!==u&&(c=xr())!==u?t=e=[e,n,c]:(cr=t,t=u)):(cr=t,t=u);return t}())!==u?(or=t,t=e??{}):(cr=t,t=u)}else cr=t,t=u;var i;return t}())===u&&(t=function(){var t,e,n,c,o,a;if(t=cr,function(){var t,e,n,c;t=cr,(e=xr())!==u?(91===r.charCodeAt(cr)?(n="[",cr++):(n=u,0===sr&&gr(E)),n!==u&&(c=xr())!==u?t=e=[e,n,c]:(cr=t,t=u)):(cr=t,t=u);return t}()!==u){if(e=cr,(n=Cr())!==u){for(c=[],o=cr,br()!==u&&(a=Cr())!==u?o=a:(cr=o,o=u);o!==u;)c.push(o),o=cr,br()!==u&&(a=Cr())!==u?o=a:(cr=o,o=u);c!==u?(or=e,e=n=[n].concat(c)):(cr=e,e=u)}else cr=e,e=u;e===u&&(e=null),e!==u&&(n=function(){var t,e,n,c;t=cr,(e=xr())!==u?(93===r.charCodeAt(cr)?(n="]",cr++):(n=u,0===sr&&gr(D)),n!==u&&(c=xr())!==u?t=e=[e,n,c]:(cr=t,t=u)):(cr=t,t=u);return t}())!==u?(or=t,t=e??[]):(cr=t,t=u)}else cr=t,t=u;return t}())===u&&(t=function(){var t,e,n,c;sr++,t=cr,(e=Er())===u&&(e=null);e!==u&&function(){var t,e,n,c;if((t=function(){var t;48===r.charCodeAt(cr)?(t="0",cr++):(t=u,0===sr&&gr(z));return t}())===u)if(t=cr,(e=function(){var t;I.test(r.charAt(cr))?(t=r.charAt(cr),cr++):(t=u,0===sr&&gr(N));return t}())!==u){for(n=[],c=Dr();c!==u;)n.push(c),c=Dr();n!==u?t=e=[e,n]:(cr=t,t=u)}else cr=t,t=u;return t}()!==u?((n=function(){var t,e,n,c;if(t=cr,(e=function(){var t;46===r.charCodeAt(cr)?(t=".",cr++):(t=u,0===sr&&gr(k));return t}())!==u){if(n=[],(c=Dr())!==u)for(;c!==u;)n.push(c),c=Dr();else n=u;n!==u?t=e=[e,n]:(cr=t,t=u)}else cr=t,t=u;return t}())===u&&(n=null),n!==u?((c=function(){var t,e,n,c,o;if(t=cr,(e=function(){var t;P.test(r.charAt(cr))?(t=r.charAt(cr),cr++):(t=u,0===sr&&gr(_));return t}())!==u)if((n=Er())===u&&(n=function(){var t;43===r.charCodeAt(cr)?(t="+",cr++):(t=u,0===sr&&gr(U));return t}()),n===u&&(n=null),n!==u){if(c=[],(o=Dr())!==u)for(;o!==u;)c.push(o),o=Dr();else c=u;c!==u?t=e=[e,n,c]:(cr=t,t=u)}else cr=t,t=u;else cr=t,t=u;return t}())===u&&(c=null),c!==u?(or=t,t=e=T()):(cr=t,t=u)):(cr=t,t=u)):(cr=t,t=u);sr--,t===u&&(e=u,0===sr&&gr(M));return t}())===u&&(t=Fr()),t}function br(){var t,e,n,c;return t=cr,(e=xr())!==u?(44===r.charCodeAt(cr)?(n=",",cr++):(n=u,0===sr&&gr(j)),n!==u&&(c=xr())!==u?t=e=[e,n,c]:(cr=t,t=u)):(cr=t,t=u),t}function wr(){var t,e,n;return t=cr,(e=Fr())!==u&&function(){var t,e,n,c;return t=cr,(e=xr())!==u?(58===r.charCodeAt(cr)?(n=":",cr++):(n=u,0===sr&&gr(O)),n!==u&&(c=xr())!==u?t=e=[e,n,c]:(cr=t,t=u)):(cr=t,t=u),t}()!==u&&(n=Cr())!==u?(or=t,t=e={name:e,value:n}):(cr=t,t=u),t}function Er(){var t;return 45===r.charCodeAt(cr)?(t="-",cr++):(t=u,0===sr&&gr(B)),t}function Fr(){var r,t,e;if(sr++,r=cr,Sr()!==u){for(t=[],e=Rr();e!==u;)t.push(e),e=Rr();t!==u&&(e=Sr())!==u?(or=r,r=t.join("")):(cr=r,r=u)}else cr=r,r=u;return sr--,r===u&&(u,0===sr&&gr(J)),r}function Rr(){var t,e,n,c,o,a,i,s,f,l;return(t=function(){var t;V.test(r.charAt(cr))?(t=r.charAt(cr),cr++):(t=u,0===sr&&gr(Y));return t}())===u&&(t=cr,function(){var t;92===r.charCodeAt(cr)?(t="\\",cr++):(t=u,0===sr&&gr(Z));return t}()!==u?(34===r.charCodeAt(cr)?(e='"',cr++):(e=u,0===sr&&gr(X)),e===u&&(92===r.charCodeAt(cr)?(e="\\",cr++):(e=u,0===sr&&gr(Z)),e===u&&(47===r.charCodeAt(cr)?(e="/",cr++):(e=u,0===sr&&gr(q)),e===u&&(e=cr,98===r.charCodeAt(cr)?(n="b",cr++):(n=u,0===sr&&gr(G)),n!==u&&(or=e,n="\b"),(e=n)===u&&(e=cr,102===r.charCodeAt(cr)?(n="f",cr++):(n=u,0===sr&&gr(L)),n!==u&&(or=e,n="\f"),(e=n)===u&&(e=cr,110===r.charCodeAt(cr)?(n="n",cr++):(n=u,0===sr&&gr(W)),n!==u&&(or=e,n="\n"),(e=n)===u&&(e=cr,114===r.charCodeAt(cr)?(n="r",cr++):(n=u,0===sr&&gr(H)),n!==u&&(or=e,n="\r"),(e=n)===u&&(e=cr,116===r.charCodeAt(cr)?(n="t",cr++):(n=u,0===sr&&gr(K)),n!==u&&(or=e,n="\t"),(e=n)===u&&(e=cr,117===r.charCodeAt(cr)?(n="u",cr++):(n=u,0===sr&&gr(Q)),n!==u?(c=cr,o=cr,(a=$r())!==u&&(i=$r())!==u&&(s=$r())!==u&&(f=$r())!==u?o=a=[a,i,s,f]:(cr=o,o=u),(c=o!==u?r.substring(c,cr):o)!==u?(or=e,l=c,e=n=String.fromCharCode(parseInt(l,16))):(cr=e,e=u)):(cr=e,e=u))))))))),e!==u?(or=t,t=e):(cr=t,t=u)):(cr=t,t=u)),t}function Sr(){var t;return 34===r.charCodeAt(cr)?(t='"',cr++):(t=u,0===sr&&gr(X)),t}function Dr(){var t;return rr.test(r.charAt(cr))?(t=r.charAt(cr),cr++):(t=u,0===sr&&gr(tr)),t}function $r(){var t;return er.test(r.charAt(cr))?(t=r.charAt(cr),cr++):(t=u,0===sr&&gr(nr)),t}if((e=i())!==u&&cr===r.length)return e;throw e!==u&&cr<r.length&&gr({type:"end"}),n=ir,c=ar<r.length?r.charAt(ar):null,o=ar<r.length?hr(ar,ar+1):hr(ar,ar),new p(p.buildMessage(n,c),n,c,o)}!function(r,t){function e(){this.constructor=r}e.prototype=t.prototype,r.prototype=new e}(f,Error),f.buildMessage=function(r,t){var e={literal:function(r){return'"'+c(r.text)+'"'},class:function(r){var t=r.parts.map((function(r){return Array.isArray(r)?o(r[0])+"-"+o(r[1]):o(r)}));return"["+(r.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(r){return r.description}};function n(r){return r.charCodeAt(0).toString(16).toUpperCase()}function c(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+n(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+n(r)}))}function o(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+n(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+n(r)}))}function u(r){return e[r.type](r)}return"Expected "+function(r){var t,e,n=r.map(u);if(n.sort(),n.length>0){for(t=1,e=1;t<n.length;t++)n[t-1]!==n[t]&&(n[e]=n[t],e++);n.length=e}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(r)+" but "+function(r){return r?'"'+c(r)+'"':"end of input"}(t)+" found."},function(r,t){function e(){this.constructor=r}e.prototype=t.prototype,r.prototype=new e}(p,Error),p.buildMessage=function(r,t){var e={literal:function(r){return'"'+c(r.text)+'"'},class:function(r){var t=r.parts.map((function(r){return Array.isArray(r)?o(r[0])+"-"+o(r[1]):o(r)}));return"["+(r.inverted?"^":"")+t+"]"},any:function(){return"any character"},end:function(){return"end of input"},other:function(r){return r.description}};function n(r){return r.charCodeAt(0).toString(16).toUpperCase()}function c(r){return r.replace(/\\/g,"\\\\").replace(/"/g,'\\"').replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+n(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+n(r)}))}function o(r){return r.replace(/\\/g,"\\\\").replace(/\]/g,"\\]").replace(/\^/g,"\\^").replace(/-/g,"\\-").replace(/\0/g,"\\0").replace(/\t/g,"\\t").replace(/\n/g,"\\n").replace(/\r/g,"\\r").replace(/[\x00-\x0F]/g,(function(r){return"\\x0"+n(r)})).replace(/[\x10-\x1F\x7F-\x9F]/g,(function(r){return"\\x"+n(r)}))}function u(r){return e[r.type](r)}return"Expected "+function(r){var t,e,n=r.map(u);if(n.sort(),n.length>0){for(t=1,e=1;t<n.length;t++)n[t-1]!==n[t]&&(n[e]=n[t],e++);n.length=e}switch(n.length){case 1:return n[0];case 2:return n[0]+" or "+n[1];default:return n.slice(0,-1).join(", ")+", or "+n[n.length-1]}}(r)+" but "+function(r){return r?'"'+c(r)+'"':"end of input"}(t)+" found."};const h=async([r],t,e)=>{r.content.startsWith("!")&&await e()},g=["roll","r"];function A(r){let t,e,n;switch(r.type){case"dice":{const{sides:u,multiplier:a,offset:i,times:s}=r;t=Array.from(o(s??1)).map(Array.isArray(u)?()=>{return(r=u)[c(0,r.length)]*(a??1)+(i??0);var r}:()=>c(1,u+1)*(a??1)+(i??0)),e=Array.isArray(t)?t.reduce(((r,t)=>r+t)):t,n=(s?`${s}`:"")+`d${JSON.stringify(u)}`+(a?`*${a}`:"")+(i?`${i>=0?"+":"-"}${Math.abs(i)}`:"")+(t.length>1?`(${t.join("+")})`:"")+`=${e}`;break}case"repeat":{const{times:c}=r;t=Array.from(o(c)).map((()=>A(r.dice))),e=t.reduce(((r,t)=>r+t.result),0),n=`{\n${u(t.map((r=>r.formatted)).join(" +\n"))}\n}=${e}`;break}case"group":t=r.dice.map(A),e=t.reduce(((r,t)=>r+t.result),0),n=`[\n${u(t.map((r=>r.formatted)).join(" +\n"))}\n]=${e}`}return{result:e,results:t,formatted:n};function c(r,t){return Math.floor(Math.random()*(t-r)+r)}function*o(r){for(let t=0;t<r;t++)yield t}function u(r,t="  "){return(t+r).replaceAll("\n","\n"+t)}}exports.RollDice=class{onReady(r,t){console.log(`Bot ${t.user?.tag} is ready.`)}onMessage([r]){const t=function(r){const t=r.match(m);if(t){const{command:e,kwargs:n}=t.groups;return{commandName:e,commandBody:r.replace(m,""),kwargs:n?d(n):void 0}}throw Error("not a command")}(r.content);console.log(`received command: ${JSON.stringify(t)}`);const{commandName:n,commandBody:c,kwargs:o}=t;if(g.includes(n)){const{debug:t=!1,help:n=!1,min:u=!1,"no-roll":a=!1}=o??{};let i;if(n)return void r.channel.send("Basic Syntax: \n   `(<REPEAT>#)?<DICE TOSS TIMES>?[dD]<DICE SIDES | DICE OPTIONS | %>(+<OFFSET>)?([Xx*]<MULTIPLIER>)`\n\nExamples: \n   `3d6`: toss a 6 sided dice 3 times\n   `3#3d6`: for 3 times, toss a 6 sided dice 3 times\n   `d[1, 2, 0]`: choose randomly from numbers 1, 2 and 0\n\nAdvanced Uses: \n   Dice Groups: \n       Two or more dice can be grouped with `,` as seperator \n       e.g.: `3#(3d6, 2d3)`, `3D[2, 3], 2D%+50`\n");if(c.length)try{i=l(c)}catch(r){return}if(void 0!==i){const n=(a?e.default:A)(i);return void(n&&r.reply(t?JSON.stringify(n):u?`${n.result}`:n.formatted))}}}},n([r.Once("ready"),c("design:type",Function),c("design:paramtypes",[Object,Function]),c("design:returntype",void 0)],exports.RollDice.prototype,"onReady",null),n([r.On("message"),r.Guard(h),c("design:type",Function),c("design:paramtypes",[Object]),c("design:returntype",void 0)],exports.RollDice.prototype,"onMessage",null),exports.RollDice=n([r.Discord()],exports.RollDice);const m=/!(?<command>[a-zA-Z+\-#$%@]+)(?<kwargs>\(.*?\))?/;exports.isCommand=h;
//# sourceMappingURL=Dice.js.map
